Malware analysis

form of incident response, analyze Point of Entry, indicators of malware presence, performance of malware – determine potential methods of prevention/detection


Understanding Malware Campaigns

two main types – targeted and mass campaigns
TARGETED – specific purpose, target – DarkHotel malware
MASS – most common, numbers game – tracked by commercial and open source companies and databases – track target industry/machinery, manufacturer, pharma, construction, education, infosec


Identification of a Malware Attack

determine delivery, execution, persistence, propagation through network traffic, file system interaction
1. - Delivery
2. - Execution
3. - Persistence Maintenance
4. - Persistence
5. - Propagation

Two main Types of fingerprinting
	Host-Based
	Network-Based


Static vs. Dynamic Analysis

STATIC – high level abstraction of the sample, analysis of the code without execution – signature analysis via checksum – quick safe but relatively shallow

DYNAMIC – observation of executing code


Common Tools

PE Tools – Dependency Walker, PeID, PE Explorer, Peview, ResourceHacker
Diassembly – IDA Freeware, WinDbg
Sysinteralsuite – ResourceHacker


MD5 Checksums of Files

using VirusTotal
HashTab application – calculate an MD5 sum for files



Identifying if Executables are Obfuscated and/or Packed

PeID can be used for this – detection through hex file headers
	executables are 4D 5A hex value



Obfuscation and Packing

using Peid, select file and view file reported as packed
	ex. <text> → <file>



PeiD will not detect homegrown packers or less known ones – detected obfuscators/packers will need to be manually unpacked – PeiD does not do this automatically

open with IDAFreeware – imports tab – few imports indicates packed – 



Introduction to Strings
	sysinternals – strings “C:\path\file”

PE Explorer –> View –> Imports –> unique imports


disassemblers + debuggers


WHAT ARE CHECKSUMS

	used for ID of files
	-risk of hash collisions - minimized with advanced algorithms
CVE-2018-2689 - malware capable of escaping VMs

online sandboxes - any.run, hybrid-analysis
	search for domain name contacts, creation of registry keys, read/writing files, creating system processes, maintaining persistence
	through system startup

	registry activty, network activity, 

Powershell
	CertUtil -hashfile <file> <hash type>
	Get-FileHash file_name -Algorithm MD5|SHA256|SHA512


MALWARE STRINGS

default logins, credentials and other sensitive pieces of information stored within strings during development cycle
malware such as botnets, ransomware rely upon information stored within strings - IP addresses to call home/C2 server

strings.exe in sysinternalssuite